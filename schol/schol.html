<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© V5.0 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --bg-dark: #111827;
            --sidebar: #1f2937;
            --primary: #d97706; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ØºØ§Ù…Ù‚ */
            --accent: #f59e0b;  /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ */
            --text: #f3f4f6;
            --glass: rgba(31, 41, 55, 0.7);
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { margin: 0; background: var(--bg-dark); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        #login-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: radial-gradient(circle, #1f2937 0%, #000000 100%);
            display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px;
            width: 400px; text-align: center; border: 1px solid var(--primary);
            backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(217, 119, 6, 0.2);
        }

        /* --- Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… --- */
        .sidebar {
            width: 280px; background: var(--sidebar); border-left: 1px solid #374151;
            display: flex; flex-direction: column; padding: 20px; transition: 0.3s;
        }
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .top-bar {
            height: 60px; background: var(--sidebar); border-bottom: 1px solid #374151;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }

        /* --- Ø§Ù„Ø¹Ù†Ø§ØµØ± --- */
        .btn {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: black; border: none; padding: 10px 20px; border-radius: 8px;
            cursor: pointer; font-weight: bold; transition: 0.2s; width: 100%; margin-top: 10px;
        }
        .btn:hover { transform: scale(1.02); }
        .btn-danger { background: #ef4444; color: white; }
        
        input, select, textarea {
            width: 100%; padding: 12px; margin: 8px 0; background: #374151;
            border: 1px solid #4b5563; color: white; border-radius: 8px; outline: none;
        }
        
        .menu-item {
            padding: 12px; margin: 5px 0; border-radius: 10px; cursor: pointer;
            color: #9ca3af; transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .menu-item:hover, .menu-item.active { background: var(--primary); color: black; }

        /* --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø© --- */
        .page-section { display: none; padding: 20px; height: 100%; overflow-y: auto; }
        .active-section { display: block; }

        .chat-box {
            height: calc(100% - 130px); overflow-y: auto; padding: 15px;
            background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px; border: 1px solid #334155;
        }
        .msg { padding: 8px 12px; margin: 5px 0; border-radius: 8px; max-width: 80%; width: fit-content; font-size: 0.9rem; }
        .msg.me { background: var(--primary); color: black; margin-right: auto; }
        .msg.other { background: #374151; margin-left: auto; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border: 1px solid #4b5563; text-align: center; }
        th { background: #374151; color: var(--accent); }

        .note-card {
            background: #374151; padding: 10px; margin-bottom: 10px; border-radius: 8px;
            border-right: 4px solid var(--primary);
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card">
        <i class="fas fa-graduation-cap fa-3x" style="color:var(--primary); margin-bottom:15px;"></i>
        <h2>Ù…Ø¯Ø§Ø±Ø³ Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨</h2>
        <p style="opacity:0.7">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ V5.0 (Cloud)</p>
        
        <input type="text" id="log-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="log-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn" onclick="app.login()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹</button>
    </div>
</div>

<div id="app-container" style="display:none; width:100%; height:100%;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px;">
            <h3 id="u-name" style="color:var(--accent)">Ù…Ø³ØªØ®Ø¯Ù…</h3>
            <span id="u-role" style="background:#374151; padding:2px 10px; border-radius:10px; font-size:0.8rem;"></span>
        </div>

        <div class="menu-item active" onclick="app.nav('dashboard')"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="menu-item" onclick="app.nav('chat')"><i class="fas fa-comments"></i> Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</div>
        
        <div id="staff-menu" style="display:none;">
            <div class="menu-item" onclick="app.nav('grades')"><i class="fas fa-edit"></i> Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
            <div class="menu-item" onclick="app.nav('notes')"><i class="fas fa-sticky-note"></i> Ø³Ø¬Ù„ Ø§Ù„Ø³Ù„ÙˆÙƒ</div>
        </div>
        
        <div id="admin-menu" style="display:none;">
            <div class="menu-item" onclick="app.nav('users')"><i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
            <div class="menu-item" onclick="app.nav('settings')"><i class="fas fa-database"></i> Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        </div>

        <div id="student-menu" style="display:none;">
            <div class="menu-item" onclick="app.nav('my-result')"><i class="fas fa-certificate"></i> Ø´Ù‡Ø§Ø¯ØªÙŠ</div>
        </div>

        <button class="btn btn-danger" onclick="location.reload()" style="margin-top:auto;"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <h3 id="page-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
            <div id="status-cloud" style="color:#10b981; font-size:0.8rem;"><i class="fas fa-cloud"></i> Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</div>
        </div>

        <div id="p-dashboard" class="page-section active-section">
            <h1>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</h1>
            <div style="display:flex; gap:20px; flex-wrap:wrap; margin-top:20px;">
                <div style="flex:1; background:#374151; padding:20px; border-radius:10px;">
                    <h3><i class="fas fa-bullhorn"></i> Ø¢Ø®Ø± Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª</h3>
                    <div id="latest-announce" style="font-size:0.9rem; opacity:0.8;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ù„ÙŠØºØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                </div>
            </div>
        </div>

        <div id="p-chat" class="page-section">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <button class="btn" style="width:auto" onclick="app.setRoom('general')">Ø§Ù„Ø¹Ø§Ù…Ø©</button>
                <button class="btn" style="width:auto" onclick="app.setRoom('announce')">Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª</button>
                <button class="btn" style="width:auto" onclick="app.setRoom('staff')" id="btn-staff-chat">ØºØ±ÙØ© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</button>
            </div>
            <h4 id="room-name" style="color:var(--accent)">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
            <div id="chat-display" class="chat-box"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
                <button class="btn" style="width:100px; margin:0;" onclick="app.sendMsg()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="p-grades" class="page-section">
            <h3>Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
            <input type="text" id="g-st" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
            <select id="g-sub">
                <option>Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option><option>Ø¹Ø±Ø¨ÙŠ</option><option>Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ</option><option>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                <option>ÙÙŠØ²ÙŠØ§Ø¡</option><option>ÙƒÙŠÙ…ÙŠØ§Ø¡</option><option>Ø£Ø­ÙŠØ§Ø¡</option><option>Ø­Ø§Ø³ÙˆØ¨</option>
                <option>Ø¬Ø±Ø§Ø¦Ù… Ø­Ø²Ø¨ Ø§Ù„Ø¨Ø¹Ø«</option>
            </select>
            <div style="display:grid; grid-template-columns: repeat(5,1fr); gap:5px;">
                <input type="number" id="sc1" placeholder="Ø´1"><input type="number" id="sc2" placeholder="Ø´2">
                <input type="number" id="sc3" placeholder="Ù†ØµÙ"><input type="number" id="sc4" placeholder="Ù2-1">
                <input type="number" id="sc5" placeholder="Ù2-2">
            </div>
            <button class="btn" onclick="app.saveGrade()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</button>
        </div>

        <div id="p-notes" class="page-section">
            <h3>Ø³Ø¬Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
            <input type="text" id="n-st" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
            <textarea id="n-txt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©..."></textarea>
            <button class="btn" onclick="app.addNote()">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø³Ø­Ø§Ø¨ÙŠØ©</button>
            <hr style="border-color:#374151; margin:20px 0;">
            <div id="notes-list"></div>
        </div>

        <div id="p-users" class="page-section">
            <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹</h3>
            <input type="text" id="u-new-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="text" id="u-new-user" placeholder="User (Ù„Ù„Ø¯Ø®ÙˆÙ„)">
            <input type="text" id="u-new-pass" placeholder="Pass">
            <select id="u-new-role"><option value="student">Ø·Ø§Ù„Ø¨</option><option value="teacher">Ù…Ø¯Ø±Ø³</option></select>
            <button class="btn" onclick="app.addUser()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø³Ø­Ø§Ø¨ÙŠ</button>
            <div id="users-list" style="margin-top:20px;"></div>
        </div>

        <div id="p-settings" class="page-section">
            <h3>ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</h3>
            <button class="btn" onclick="app.exportData()" style="background:#10b981;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</button>
        </div>

        <div id="p-my-result" class="page-section">
            <div id="cert-print" style="background:white; color:black; padding:30px; border:10px double var(--primary);">
                <div style="text-align:center; border-bottom:2px solid black; padding-bottom:10px;">
                    <h2>Ù…Ø¯Ø§Ø±Ø³ Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©</h2>
                    <p>ÙˆØ«ÙŠÙ‚Ø© Ø¯Ø±Ø¬Ø§Øª Ù„Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026</p>
                </div>
                <h3 id="cert-name" style="margin-top:20px;">Ø§Ù„Ø·Ø§Ù„Ø¨: </h3>
                <table style="width:100%; border:1px solid black; margin-top:20px;">
                    <thead><tr style="background:#eee;"><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</th><th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th></tr></thead>
                    <tbody id="cert-body"></tbody>
                </table>
                <div id="cert-notes-area" style="margin-top:20px; font-size:0.9rem;"></div>
            </div>
            <button class="btn" onclick="app.printCert()">Ø·Ø¨Ø§Ø¹Ø© PDF</button>
        </div>
    </div>
</div>

<script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyDjps8vgN3n-TlvJBUW87u_zjhkO_hxCJE",
        authDomain: "shatt-school.firebaseapp.com",
        databaseURL: "https://shatt-school-default-rtdb.firebaseio.com",
        projectId: "shatt-school",
        storageBucket: "shatt-school.firebasestorage.app",
        messagingSenderId: "484274570535",
        appId: "1:484274570535:web:8e780b61c5975ee8e2d502"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        currentUser: null,
        currentRoom: 'general',

        login: function() {
            const u = document.getElementById('log-user').value;
            const p = document.getElementById('log-pass').value;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            if(u === 'admin' && p === '951357094') {
                this.currentUser = {name:'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…', user:'admin', role:'admin'};
                this.launch();
                return;
            }

            db.ref('users').once('value', (snap) => {
                const users = snap.val();
                let found = false;
                for(let id in users) {
                    if(users[id].user === u && users[id].pass === p) {
                        this.currentUser = users[id];
                        found = true;
                        this.launch();
                        break;
                    }
                }
                if(!found) alert('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©');
            });
        },

        launch: function() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            document.getElementById('u-name').innerText = this.currentUser.name;
            document.getElementById('u-role').innerText = this.currentUser.role;
            
            if(this.currentUser.role === 'admin') document.getElementById('admin-menu').style.display = 'block';
            if(['admin','teacher'].includes(this.currentUser.role)) document.getElementById('staff-menu').style.display = 'block';
            if(this.currentUser.role === 'student') {
                document.getElementById('student-menu').style.display = 'block';
                document.getElementById('btn-staff-chat').style.display = 'none';
            }
            this.nav('dashboard');
            this.syncChat();
            this.syncAnnouncements();
        },

        nav: function(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-section'));
            document.getElementById('p-'+pageId).classList.add('active-section');
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById('page-title').innerText = pageId;
            if(pageId === 'users') this.renderUsers();
            if(pageId === 'my-result') this.renderCert();
            if(pageId === 'notes') this.renderAllNotes();
        },

        addUser: function() {
            const data = {
                name: document.getElementById('u-new-name').value,
                user: document.getElementById('u-new-user').value,
                pass: document.getElementById('u-new-pass').value,
                role: document.getElementById('u-new-role').value
            };
            db.ref('users').push(data);
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹');
        },

        renderUsers: function() {
            db.ref('users').on('value', (snap) => {
                const list = document.getElementById('users-list');
                list.innerHTML = '';
                const users = snap.val();
                for(let id in users) {
                    list.innerHTML += `<div style="background:#374151; padding:10px; margin:5px 0; border-radius:5px;">${users[id].name} (${users[id].role})</div>`;
                }
            });
        },

        saveGrade: function() {
            const st = document.getElementById('g-st').value;
            const sub = document.getElementById('g-sub').value;
            const scores = [1,2,3,4,5].map(i => document.getElementById('sc'+i).value || 0);
            db.ref(`grades/${st}/${sub}`).set(scores);
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹');
        },

        addNote: function() {
            const st = document.getElementById('n-st').value;
            const txt = document.getElementById('n-txt').value;
            db.ref(`notes/${st}`).push({
                writer: this.currentUser.name,
                text: txt,
                date: new Date().toLocaleDateString('ar-IQ')
            });
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø³Ø­Ø§Ø¨Ø©');
        },

        renderAllNotes: function() {
            db.ref('notes').on('value', (snap) => {
                const list = document.getElementById('notes-list');
                list.innerHTML = '<h4>Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</h4>';
                const allNotes = snap.val();
                for(let st in allNotes) {
                    for(let id in allNotes[st]) {
                        list.innerHTML += `<div class="note-card"><b>${st}:</b> ${allNotes[st][id].text} <br><small>Ø¨ÙˆØ§Ø³Ø·Ø©: ${allNotes[st][id].writer}</small></div>`;
                    }
                }
            });
        },

        setRoom: function(r) {
            this.currentRoom = r;
            document.getElementById('room-name').innerText = r === 'general' ? 'Ø§Ù„Ø¹Ø§Ù…Ø©' : (r === 'announce' ? 'Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª' : 'ØºØ±ÙØ© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©');
            this.syncChat();
        },

        sendMsg: function() {
            const txt = document.getElementById('chat-input').value;
            if(!txt) return;
            db.ref(`chats/${this.currentRoom}`).push({
                user: this.currentUser.name,
                text: txt
            });
            document.getElementById('chat-input').value = '';
        },

        syncChat: function() {
            db.ref(`chats/${this.currentRoom}`).on('value', (snap) => {
                const div = document.getElementById('chat-display');
                div.innerHTML = '';
                const msgs = snap.val();
                for(let id in msgs) {
                    const m = msgs[id];
                    div.innerHTML += `<div class="msg ${m.user === this.currentUser.name ? 'me' : 'other'}"><b>${m.user}:</b> ${m.text}</div>`;
                }
                div.scrollTop = div.scrollHeight;
            });
        },

        syncAnnouncements: function() {
            db.ref('chats/announce').limitToLast(1).on('value', (snap) => {
                const data = snap.val();
                if(data) {
                    const lastMsg = Object.values(data)[0];
                    document.getElementById('latest-announce').innerText = lastMsg.text;
                }
            });
        },

        renderCert: function() {
            const stName = this.currentUser.name;
            document.getElementById('cert-name').innerText = "Ø§Ù„Ø·Ø§Ù„Ø¨: " + stName;
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
            db.ref(`grades/${stName}`).on('value', (snap) => {
                const grades = snap.val() || {};
                const tbody = document.getElementById('cert-body');
                tbody.innerHTML = '';
                for(let sub in grades) {
                    const g = grades[sub];
                    let sum=0, c=0;
                    g.forEach(v => { if(v) { sum+=parseFloat(v); c++; } });
                    const avg = c > 0 ? (sum/c).toFixed(1) : '-';
                    tbody.innerHTML += `<tr><td style="color:black">${sub}</td><td style="color:black">${g.join(' | ')}</td><td style="color:black">${avg}</td></tr>`;
                }
            });

            // Ø¬Ù„Ø¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            db.ref(`notes/${stName}`).on('value', (snap) => {
                const area = document.getElementById('cert-notes-area');
                area.innerHTML = '<b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø³Ù„ÙˆÙƒ:</b><br>';
                const notes = snap.val();
                for(let id in notes) {
                    area.innerHTML += `- ${notes[id].text} (${notes[id].date})<br>`;
                }
            });
        },

        printCert: function() { html2pdf().from(document.getElementById('cert-print')).save('Shatt_Result.pdf'); },

        exportData: function() {
            db.ref('/').once('value').then((snap) => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(snap.val()));
                const node = document.createElement('a');
                node.setAttribute("href", dataStr);
                node.setAttribute("download", "shatt_cloud_backup.json");
                node.click();
            });
        }
    };
</script>
</body>
</html>
