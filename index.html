<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© V5.0</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
    --bg-dark:#111827;
    --sidebar:#1f2937;
    --primary:#d97706;
    --accent:#f59e0b;
    --text:#f3f4f6;
}
*{box-sizing:border-box;font-family:Segoe UI}
body{margin:0;background:var(--bg-dark);color:var(--text);height:100vh;display:flex;overflow:hidden}

/* Login */
#login-overlay{position:fixed;inset:0;background:radial-gradient(circle,#1f2937,#000);display:flex;align-items:center;justify-content:center;z-index:9999}
.login-card{background:rgba(255,255,255,.05);padding:40px;border-radius:20px;width:400px;text-align:center;border:1px solid var(--primary)}

/* Layout */
.sidebar{width:280px;background:var(--sidebar);padding:20px;display:flex;flex-direction:column}
.main-content{flex:1;display:flex;flex-direction:column}
.top-bar{height:60px;background:var(--sidebar);display:flex;align-items:center;justify-content:space-between;padding:0 20px}

/* Elements */
.btn{background:linear-gradient(45deg,var(--primary),var(--accent));border:none;padding:10px;border-radius:8px;font-weight:bold;cursor:pointer;width:100%;margin-top:10px}
.btn-danger{background:#ef4444;color:#fff}
input,select,textarea{width:100%;padding:10px;background:#374151;border:1px solid #555;border-radius:8px;color:#fff;margin:5px 0}
.menu-item{padding:10px;border-radius:8px;cursor:pointer;color:#9ca3af;margin:4px 0}
.menu-item:hover,.menu-item.active{background:var(--primary);color:#000}

.page-section{display:none;padding:20px;height:100%;overflow-y:auto}
.active-section{display:block}

.chat-box{height:calc(100% - 60px);overflow-y:auto;background:#0002;padding:10px;border-radius:10px}
.msg{padding:6px 10px;border-radius:8px;margin:4px 0;max-width:80%}
.me{background:var(--primary);color:#000;margin-right:auto}
.other{background:#374151;margin-left:auto}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #555;padding:8px;text-align:center}
th{background:#374151;color:var(--accent)}

.note-card{background:#374151;padding:8px;border-right:4px solid var(--primary);margin:5px 0;border-radius:6px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-overlay">
<div class="login-card">
<h2>Ù…Ø¯Ø§Ø±Ø³ Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨</h2>
<p>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ V5.0</p>
<input id="log-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="log-pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="btn" onclick="app.login()">Ø¯Ø®ÙˆÙ„</button>
<p style="font-size:12px;color:#aaa">admin / 951357094</p>
</div>
</div>

<div id="app-container" style="display:none;width:100%;height:100%">
<div class="sidebar">
<h3 id="u-name"></h3>
<span id="u-role"></span>

<div class="menu-item active" onclick="app.nav('dashboard',this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
<div class="menu-item" onclick="app.nav('chat',this)">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</div>

<div id="staff-menu" style="display:none">
<div class="menu-item" onclick="app.nav('grades',this)">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
<div class="menu-item" onclick="app.nav('notes',this)">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
</div>

<div id="admin-menu" style="display:none">
<div class="menu-item" onclick="app.nav('users',this)">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
</div>

<div id="student-menu" style="display:none">
<div class="menu-item" onclick="app.nav('my-result',this)">Ø´Ù‡Ø§Ø¯ØªÙŠ</div>
</div>

<button class="btn btn-danger" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="main-content">
<div class="top-bar"><h3 id="page-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3></div>

<div id="p-dashboard" class="page-section active-section">
<h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
<div>Ø¢Ø®Ø± ØªØ¨Ù„ÙŠØº: <span id="latest-announce">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span></div>
</div>

<div id="p-chat" class="page-section">
<h3 id="room-name">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
<div id="chat-display" class="chat-box"></div>
<input id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
<button class="btn" onclick="app.sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<div id="p-grades" class="page-section">
<input id="g-st" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
<select id="g-sub"><option>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option><option>Ø¹Ø±Ø¨ÙŠ</option></select>
<input id="sc1" placeholder="Ø¯Ø±Ø¬Ø©">
<button class="btn" onclick="app.saveGrade()">Ø­ÙØ¸</button>
</div>

<div id="p-notes" class="page-section">
<input id="n-st" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
<textarea id="n-txt"></textarea>
<button class="btn" onclick="app.addNote()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="notes-list"></div>
</div>

<div id="p-users" class="page-section">
<input id="u-new-name" placeholder="Ø§Ù„Ø§Ø³Ù…">
<input id="u-new-user" placeholder="username">
<input id="u-new-pass" placeholder="password">
<select id="u-new-role"><option value="student">Ø·Ø§Ù„Ø¨</option><option value="teacher">Ù…Ø¯Ø±Ø³</option></select>
<button class="btn" onclick="app.addUser()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="users-list"></div>
</div>

<div id="p-my-result" class="page-section">
<div id="cert-print" style="background:#fff;color:#000;padding:20px">
<h3 id="cert-name"></h3>
<table><tbody id="cert-body"></tbody></table>
</div>
<button class="btn" onclick="app.printCert()">PDF</button>
</div>

</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDjps8vgN3n-TlvJBUW87u_zjhkO_hxCJE",
authDomain:"shatt-school.firebaseapp.com",
databaseURL:"https://shatt-school-default-rtdb.firebaseio.com",
projectId:"shatt-school",
storageBucket:"shatt-school.firebasestorage.app",
messagingSenderId:"484274570535",
appId:"1:484274570535:web:8e780b61c5975ee8e2d502"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const DB_NAME="ShattArabV5_DB";

const app={
data:{users:[],grades:{},notes:{},chats:{general:[]}},
currentUser:null,

init(){
db.ref(DB_NAME).on("value",s=>{
if(s.exists())this.data=s.val();
else{
this.data.users.push({name:"Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…",user:"admin",pass:"951357094",role:"admin"});
db.ref(DB_NAME).set(this.data);
}
});
},

save(){db.ref(DB_NAME).set(this.data);},

login(){
const u=log-user.value,p=log-pass.value;
const user=this.data.users.find(x=>x.user===u&&x.pass===p);
if(!user)return alert("Ø®Ø·Ø£");
this.currentUser=user;
login-overlay.style.display="none";
app-container.style.display="flex";
u-name.innerText=user.name;
u-role.innerText=user.role;
if(user.role!=="student")staff-menu.style.display="block";
if(user.role==="admin")admin-menu.style.display="block";
if(user.role==="student")student-menu.style.display="block";
},

nav(id,el){
document.querySelectorAll(".page-section").forEach(p=>p.classList.remove("active-section"));
document.getElementById("p-"+id).classList.add("active-section");
document.querySelectorAll(".menu-item").forEach(m=>m.classList.remove("active"));
el.classList.add("active");
},

sendMsg(){
this.data.chats.general.push({user:this.currentUser.name,text:chat-input.value});
chat-input.value="";
this.save();
this.renderChat();
},

renderChat(){
chat-display.innerHTML=this.data.chats.general.map(m=>`<div class="msg ${m.user===this.currentUser.name?"me":"other"}">${m.text}</div>`).join("");
},

addUser(){
this.data.users.push({
name:u-new-name.value,
user:u-new-user.value,
pass:u-new-pass.value,
role:u-new-role.value
});
this.save();
},

saveGrade(){
const st=g-st.value;
if(!this.data.grades[st])this.data.grades[st]={};
this.data.grades[st][g-sub.value]=[sc1.value];
this.save();
},

addNote(){
if(!this.data.notes[n-st.value])this.data.notes[n-st.value]=[];
this.data.notes[n-st.value].push(n-txt.value);
this.save();
},

printCert(){html2pdf().from(cert-print).save("cert.pdf");}
};

app.init();
</script>
</body>
</html>
